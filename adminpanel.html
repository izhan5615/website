<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>20F-0232_20F-0141</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- daterange picker -->
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Bootstrap Color Picker -->
  <link rel="stylesheet" href="plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="plugins/select2/css/select2.min.css">
  <link rel="stylesheet" href="plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
  <!-- Bootstrap4 Duallistbox -->
  <link rel="stylesheet" href="plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css">
  <!-- BS Stepper -->
  <link rel="stylesheet" href="plugins/bs-stepper/css/bs-stepper.min.css">
  <!-- dropzonejs -->
  <link rel="stylesheet" href="plugins/dropzone/min/dropzone.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <link rel="stylesheet" href="plugins/summernote/summernote-bs4.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    #map {
      height: 400px;
      width: 100%;
    }


    aside {
      background: linear-gradient(to bottom, #555555, #000000);
    }

    .delete-button {
      background-color: #e74c3c;
      color: white;
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .product-image {
      width: 30%;
      height: 30%;
    }
  </style>
</head>

<body class="hold-transition sidebar-mini">
  <div class="wrapper">


    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">


      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            <img src="images/user.png" class="img-circle elevation-2" alt="User Image">
          </div>
          <div class="info">
            <a href="#" id="name-sidebar" class="d-block"></a>
          </div>
        </div>

        <!-- SidebarSearch Form -->
        <div class="form-inline">
          <div class="input-group" data-widget="sidebar-search">
            <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
            <div class="input-group-append">
              <button class="btn btn-sidebar">
                <i class="fas fa-search fa-fw"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->

            <li class="nav-item">
              <a href="adminpanel.html" class="nav-link">
                <i class="nav-icon fas fa-clipboard-list"></i>
                <p>
                  Manage Orders
                </p>
              </a>
            </li>

        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 id="">Orders Status </h1>
            </div>

          </div>
        </div><!-- /.container-fluid -->
      </section>

      <!-- Main content -->

      <body class="hold-transition sidebar-mini">


        <div id="cont">

        </div>





        <!-- jQuery -->
        <script src="plugins/jquery/jquery.min.js"></script>
        <!-- Bootstrap 4 -->
        <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- Select2 -->
        <script src="plugins/select2/js/select2.full.min.js"></script>
        <!-- Bootstrap4 Duallistbox -->
        <script src="plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>
        <!-- InputMask -->
        <script src="plugins/moment/moment.min.js"></script>
        <script src="plugins/inputmask/jquery.inputmask.min.js"></script>
        <!-- date-range-picker -->
        <script src="plugins/daterangepicker/daterangepicker.js"></script>
        <!-- bootstrap color picker -->
        <script src="plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
        <!-- Tempusdominus Bootstrap 4 -->
        <script src="plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
        <!-- Bootstrap Switch -->
        <script src="plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>
        <!-- BS-Stepper -->
        <script src="plugins/bs-stepper/js/bs-stepper.min.js"></script>
        <!-- dropzonejs -->
        <script src="plugins/dropzone/min/dropzone.min.js"></script>
        <!-- AdminLTE App -->
        <script src="dist/js/adminlte.min.js"></script>
        <!-- AdminLTE for demo purposes -->
        <script src="dist/js/demo.js"></script>
        <!-- Page specific script -->
        <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- jquery-validation -->
        <script src="plugins/jquery-validation/jquery.validate.min.js"></script>
        <script src="plugins/jquery-validation/additional-methods.min.js"></script>
        <script src="plugins/summernote/summernote-bs4.min.js"></script>
        <!-- AdminLTE App -->
        <script src="dist/js/adminlte.min.js"></script>
        <script>
          $("#name-sidebar").append(sessionStorage.getItem("name"));

          var title = "";

          $(document).ready(function () {

            getOrders();
          });





          function getOrders() {




            $.ajax({
              url: 'http://localhost:4000/getAllOrders',
              headers: {
                'Content-Type': 'application/json'
              },
              type: 'GET',
              contentType: 'application/json',

              success: function (results) {

                var cont = document.getElementById("cont");
                var count = 1;
                var table;

                results.forEach(function (obj) {
                  title = "<br><h2> Order ID : " + obj.id + "</h2><br><table><tr> <th>Order Id</th><th>Customer</th><th>Contact</th><th>Coordinates</th><th>Bill</th><th>Status</th><th>Action</th></tr>";

                  title += "<tr><td>" + obj.id + "</td><td>" + obj.name + "</td> <td> " + obj.phone + "</td><td>" + obj.latitude + "," + obj.longitude + "</td><td>" + obj.bill + "</td><td>" + obj.Status + "</td><td>" + "<button class='btn btn-success btn-sm' id='" + obj.id + "' onclick='approve(\"" + obj.id + "\", \"" + obj.orderId + "\");'>Approve</button>" + "<button class='btn btn-danger btn-sm' id='" + obj.id + "' onclick='reject(\"" + obj.id + "\", \"" + obj.orderId + "\");'>Reject</button>" + " </td></tr>";


                  title += "<tr><th>Supplier Id</th><th>Reseller Id</th><th>Product ID</th><th>Quantity</th><th>Sub Status</th></tr>";
                  for (var i = 0; i < obj.orderCount; i++)
                    title += "<tr><td>" + obj.supplier + "</td><td>" + obj.resellerId + "</td> <td> " + obj.productId + "</td><td>" + obj.quantity + "</td><td>" + obj.substatus + "</td></tr>";

                  title += "</table><br>";
                  cont.innerHTML += title;
                });



              },
              error: function () {
                alert('error');
              }
            });


          }

          function getOrdersList(orderId, title) {


            var data = { orderId: orderId };
            let post = JSON.stringify(data);
            $.ajax({
              url: 'http://localhost:4000/getAllOrdersList',
              headers: {
                'Content-Type': 'application/json'
              },
              type: 'POST',
              contentType: 'application/json',
              data: post,
              success: function (results) {

                var cont = document.getElementById("cont");
                var count = 1;
                var table;

                results.forEach(function (obj) {

                  title += "<tr><td>" + obj.supplier + "</td><td>" + obj.resellerId + "</td> <td> " + obj.productId + "</td><td>" + obj.quanitity + "</td><td>" + obj.Status + "</td></tr>";


                });



              },
              error: function () {
                alert('error');
              }
            });


          }

          function approve(id) {

            var data = { id: id };
            let post = JSON.stringify(data);

            $.ajax({
              url: 'http://localhost:4000/approveOrder',
              headers: {
                'Content-Type': 'application/json'
              },
              type: 'PUT',
              contentType: 'application/json',
              data: post,
              success: function (results) {
                alert("Approved");
                location.reload();
              },
              error: function () {
                alert('error');
              }
            });
          }
          function reject(id) {

            var data = { id: id };
            let post = JSON.stringify(data);

            $.ajax({
              url: 'http://localhost:4000/rejectOrder',
              headers: {
                'Content-Type': 'application/json'
              },
              type: 'PUT',
              contentType: 'application/json',
              data: post,
              success: function (results) {
                alert("Cancelled");
                location.reload();
              },
              error: function () {
                alert('error');
              }
            });
          }
        </script>
      </body>

</html>