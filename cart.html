<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>20F-0232_20F-0141</title>

  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- daterange picker -->
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Bootstrap Color Picker -->
  <link rel="stylesheet" href="plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="plugins/select2/css/select2.min.css">
  <link rel="stylesheet" href="plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
  <!-- Bootstrap4 Duallistbox -->
  <link rel="stylesheet" href="plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css">
  <!-- BS Stepper -->
  <link rel="stylesheet" href="plugins/bs-stepper/css/bs-stepper.min.css">
  <!-- dropzonejs -->
  <link rel="stylesheet" href="plugins/dropzone/min/dropzone.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <link rel="stylesheet" href="plugins/summernote/summernote-bs4.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }

    aside {
      background: linear-gradient(to bottom, #461686, #461686)
    }

    th,
    td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    #map {
      height: 400px;
      width: 100%;
    }

    .delete-button {
      background-color: #e74c3c;
      color: white;
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .product-image {
      width: 30%;
      height: 30%;
    }
  </style>
</head>

<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    <!-- Navbar -->


    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">


      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            <img src="images/user.png" class="img-circle elevation-2" alt="User Image">
          </div>
          <div class="info">
            <a href="#" id="name-sidebar" class="d-block"></a>
          </div>
        </div>

        <!-- SidebarSearch Form -->
        <div class="form-inline">
          <div class="input-group" data-widget="sidebar-search">
            <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
            <div class="input-group-append">
              <button class="btn btn-sidebar">
                <i class="fas fa-search fa-fw"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
            <li class="nav-item">
              <a href="cart.html" class="nav-link">
                <i class="nav-icon fas fa-shopping-basket"></i>
                <p>
                  Check Cart
                </p>
              </a>

            </li>
            <li class="nav-item">
              <a href="allProducts.html" class="nav-link">
                <i class="nav-icon fas fa-store"></i>
                <p>
                  Store
                </p>
              </a>
            </li>
            <li class="nav-item">
              <a href="myOrders.html" class="nav-link">
                <i class="nav-icon fas fa-clipboard-list"></i>
                <p>
                  Store
                </p>
              </a>
            </li>

        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <li class="fa fa-shopping-cart"></li>
              <h1 class="text-bold">
                My Cart
              </h1>
            </div>

          </div>
        </div><!-- /.container-fluid -->
      </section>

      <!-- Main content -->

      <body class="hold-transition sidebar-mini">


        <table id='cart'>
          <tr>
            <th>Delete</th>
            <th>Product Image</th>
            <th>Product Title</th>
            <th>Price Per Unit</th>
            <th>Quantity</th>

          </tr>

          <!-- Add more rows for other products -->
        </table>
        <table>
          <tr>
            <th>Total</th>
            <th id="total"> </th>

          </tr>

          <!-- Add more rows for other products -->
        </table>

        <div class="card card-primary">
          <div class="card-header">
            <h3 class="card-title">Customer Information</h3>
          </div>
          <!-- /.card-header -->
          <div class="card-body">
            <form>
              <div class="row">
                <div class="col-sm-6">
                  <!-- text input -->
                  <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name='name' id="name" class="form-control" placeholder="Enter ...">
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" name='phone' id="phone" class="form-control" placeholder="Enter ...">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <!-- text input -->
                  <div class="form-group">
                    <label>Billing Amount</label>
                    <input type="number" name='bill' id='bill' class="form-control" placeholder="Enter ...">
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label>Profit</label>
                    <input type="number" name='profit' id='profitCalculator' class="form-control"
                      placeholder="Enter ..." disabled>

                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label>Order ID</label>
                    <input type="text" name='orderId' id="orderId" class="form-control" placeholder="Enter ...">

                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <!-- text input -->
                  <div class="form-group">
                    <input id="pac-input" style="margin-bottom: 5px" class="form-control"
                      placeholder="Search your location on Map (Pointer is also movable)">
                    <div id="map"></div>

                  </div>

                </div>

              </div>
              <div class="row">
                <input type="hidden" name="lattitude" id="lattitude" />
                <input type="hidden" name="longitude" id="longitude" />
              </div>



            </form>
            <button type="button" onclick='placeorder();' class="btn btn-lg btn-primary float-right"
              value="Place Order">Place Order</button>
          </div>
        </div>












        <!-- jQuery -->
        <script src="plugins/jquery/jquery.min.js"></script>
        <!-- Bootstrap 4 -->
        <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- Select2 -->
        <script src="plugins/select2/js/select2.full.min.js"></script>
        <!-- Bootstrap4 Duallistbox -->
        <script src="plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>
        <!-- InputMask -->
        <script src="plugins/moment/moment.min.js"></script>
        <script src="plugins/inputmask/jquery.inputmask.min.js"></script>
        <!-- date-range-picker -->
        <script src="plugins/daterangepicker/daterangepicker.js"></script>
        <!-- bootstrap color picker -->
        <script src="plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
        <!-- Tempusdominus Bootstrap 4 -->
        <script src="plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
        <!-- Bootstrap Switch -->
        <script src="plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>
        <!-- BS-Stepper -->
        <script src="plugins/bs-stepper/js/bs-stepper.min.js"></script>
        <!-- dropzonejs -->
        <script src="plugins/dropzone/min/dropzone.min.js"></script>
        <!-- AdminLTE App -->
        <script src="dist/js/adminlte.min.js"></script>
        <!-- AdminLTE for demo purposes -->
        <script src="dist/js/demo.js"></script>
        <!-- Page specific script -->
        <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- jquery-validation -->
        <script src="plugins/jquery-validation/jquery.validate.min.js"></script>
        <script src="plugins/jquery-validation/additional-methods.min.js"></script>
        <script src="plugins/summernote/summernote-bs4.min.js"></script>
        <!-- AdminLTE App -->
        <script src="dist/js/adminlte.min.js"></script>
        <script>
          var total = 0;
          $("#name-sidebar").append(sessionStorage.getItem("name"));
          $("#nameHeader").append(sessionStorage.getItem("name"));


          $(document).ready(function () {

            getProduct();
          });



          function placeorder() {
            var name = $('#name').val();
            var resellerId = sessionStorage.getItem("resellerId");
            var phone = $('#phone').val();
            var bill = $('#bill').val();
            var lattitude = $('#lattitude').val();
            var longitude = $('#longitude').val();
            var orderId = $("#orderId").val();





            var data = { resellerId: resellerId, name: name, phone: phone, bill: bill, lattitude: lattitude, longitude: longitude, orderId: orderId, bill: bill };
            let post = JSON.stringify(data);
            console.log(post);
            $.ajax({
              url: 'http://localhost:4000/placeorder',
              headers: {
                'Content-Type': 'application/json'
              },
              type: 'POST',
              contentType: 'application/json',
              data: post,
              success: function (results) {
                alert("Order Placed");
                clearcart();


              },
              error: function () {
                alert('error');
              }
            });


          }


          function deleteFromCart(id) {

            var resellerId = sessionStorage.getItem("resellerId");
            var productId = id

            $.ajax({
              url: 'http://localhost:4000/deletefromcart',
              type: "DELETE",
              data: {
                resellerId: resellerId,
                productId: productId
              },
              success: function (response) {
                alert(response);
                location.reload();
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
              }
            });


          }




          function clearcart() {


            $.ajax({
              url: 'http://localhost:4000/clearcart',
              type: "DELETE",

              success: function (response) {
                alert(response);
                location.reload();
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
              }
            });


          }

          function getProduct() {
            var resellerId = sessionStorage.getItem("resellerId");

            var data = { resellerId: resellerId };
            let post = JSON.stringify(data);

            $.ajax({
              url: 'http://localhost:4000/getcart',
              headers: {
                'Content-Type': 'application/json'
              },
              type: 'POST',
              contentType: 'application/json',
              data: post,
              success: function (results) {

                var cont = document.getElementById("cart");
                var count = 1;



                results.forEach(function (obj) {

                  title = " <tr class ='r'><td><button id='" + obj.id + "' onclick='deleteFromCart(this.id);'  class='delete-button'>&times;</button></td>";

                  title += " <td><img src='upload/" + obj.image + "'' alt='Product 1' class='product-image'></td>";

                  title += "  <td>" + obj.title + "</td>  <td>Rs" + obj.price + "</td><td id='" + obj.id + "'> " + obj.quantity + "</td> </tr>";

                  total += (obj.price * obj.quantity);
                  cont.innerHTML += title;
                  document.getElementById("total").innerHTML = total;


                });

                $(".r").fadeOut(1);

              },
              error: function () {
                alert('error');
              }
            });


          }

          $("#bill").change(function () {
            if ($("#bill").val() != null) {
              var bill = $("#bill").val();


              $("#profitCalculator").val((bill) - (total));
            }
          });






          setTimeout(function () {
            // Code to be executed after the delay
            $(".r").fadeIn(2000);
          }, 1000);




        </script>

        <script>
          function validate(evt) {
            var theEvent = evt || window.event;

            // Handle paste
            if (theEvent.type === "paste") {
              key = event.clipboardData.getData("number");
            } else {
              // Handle key press
              var key = theEvent.keyCode || theEvent.which;
              key = String.fromCharCode(key);
            }
            var regex = /[0-9]/;
            if (!regex.test(key)) {
              theEvent.returnValue = false;
              if (theEvent.preventDefault) theEvent.preventDefault();
            }
          }

          var map;

          function initAutocomplete() {
            var map = new google.maps.Map(document.getElementById("map"), {
              center: {
                lat: 30.3753,
                lng: 69.3451,
              },
              zoom: 5,
            });

            var options = {
              componentRestrictions: { country: "pk" },
            };

            var input = document.getElementById("pac-input");
            var autocomplete = new google.maps.places.Autocomplete(input, options);

            autocomplete.bindTo("bounds", map);

            var infowindow = new google.maps.InfoWindow();

            var marker = new google.maps.Marker({
              draggable: true,
              map: map,
            });

            autocomplete.addListener("place_changed", function () {
              var place = autocomplete.getPlace();
              var lattitude = place.geometry.location.lat();
              var longitude = place.geometry.location.lng();

              google.maps.event.addListener(marker, "dragend", function (event) {
                document.getElementById("lattitude").value = this.getPosition().lat();
                document.getElementById("longitude").value = this.getPosition().lng();

                //Marker Location Changed

                document.getElementById("latitude").value = this.getPosition().lat();

                document.getElementById("longitude").value = this.getPosition().lng();
              });

              //alert(lattitude + ' ' + longitude);
              document.getElementById("lattitude").value = lattitude;
              document.getElementById("longitude").value = longitude;

              //Selected Place Changed

              //alert("Hello");

              infowindow.close();
              marker.setVisible(false);
              var place = autocomplete.getPlace();
              if (!place.geometry) {
                window.alert("Autocomplete's returned place contains no geometry");
                return;
              }

              // If the place has a geometry, then present it on a map.
              if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
              } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);
                // Why 17? Because it looks good.
              }

              marker.setPosition(place.geometry.location);
              marker.setVisible(true);

              var address = "";
              if (place.address_components) {
                address = [
                  (place.address_components[0] &&
                    place.address_components[0].short_name) ||
                  "",
                  (place.address_components[1] &&
                    place.address_components[1].short_name) ||
                  "",
                  (place.address_components[2] &&
                    place.address_components[2].short_name) ||
                  "",
                ].join(" ");
              }

              infowindow.setContent(
                "<div><strong>" + place.name + "</strong><br>" + address
              );
              infowindow.open(map, marker);

              // iterate through address_component array
            });
          }
          function muSubFun() {
            var latitude = document.getElementById("lattitude").value;
            var longitude = document.getElementById("longitude").value;
            var input = document.getElementById("pac-input").value;
            var roll = document.getElementById("roll-input").value;


            alert(latitude);
            alert(longitude);

            /*	
              $.post("controller.php", {
              	
              	
                lat : 1,
                lon : 2,
                inp : 'kjsdkf afkjdkdajf jkdfakdfkad hkdafhk',
                rol : 3,			
              	
                action : 'adddata'
              	
              }, function(result) {
            	
              	
                alert("Datab Added");
              	
              });		
            	
              */


          }

        </script>
        <script
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9irjntPHdEJf024h7H_XKpS11OeW1Nh8&libraries=places&callback=initAutocomplete"
          async defer>
          </script>
      </body>

</html>